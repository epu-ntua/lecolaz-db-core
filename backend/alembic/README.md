# Alembic (Migrations) Workflow

## What Alembic Does

Alembic:

- Tracks schema changes over time
- Generates migration files
- Applies them to the database

## When To Use Alembic

Use Alembic after you:

- Create a new ORM model
- Edit an existing ORM model

## Preferred: Run Alembic Via Docker (Recommended)

This avoids local env/setup issues and uses the same configuration as the backend container.

### Creating A Migration

From infra folder run: 

```sh
docker compose exec backend alembic revision --autogenerate -m "short description"
```

This creates a file in:

```
alembic/versions/
```

## Always Review The Migration

Before applying:

- Open the generated file
- Check that it matches your intent
- Watch for accidental drops or deletes

## Applying Migrations

```sh
docker compose exec backend alembic upgrade head
```

This updates the actual database schema.

## New Environment / New Machine

To bring a database up to date:

```sh
docker compose exec backend alembic upgrade head
```

## Golden Rules

- Never edit old migrations that were already applied
- Never skip reviewing autogenerated migrations
- Schema changes = ORM change -> Alembic migration -> upgrade
